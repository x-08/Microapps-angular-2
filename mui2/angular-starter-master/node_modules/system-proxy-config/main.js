var winreg = require('winreg');
var proxyModule = {
    getProxy: function (_cb) {
        var proxy = {
            enabled: false,
            adress: ""
        };
        var regKey = new winreg({
            hive: winreg.HKCU,
            key:  '\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\'
        });

        regKey.values(function (err, items) {
            if (err) {
                console.log("Error " + err);
                if (_cb !== undefined) _cb.call(proxy);
            }

            else {
                for (var i in items) {
                    if (items.hasOwnProperty(i)) {
                        if (items[i].name === "ProxyEnable" && items[i].value === "0x1") {
                            proxy.enabled = true;
                        }
                        if (items[i].name === "ProxyServer") {
                            proxy.adress = "http://" + items[i].value;
                        }
                    }
                }
                if (_cb !== undefined) _cb.call(proxy);
            }
        });
    }
}
module.exports = proxyModule;